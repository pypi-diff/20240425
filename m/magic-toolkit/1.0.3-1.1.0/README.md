# Comparing `tmp/magic_toolkit-1.0.3-py3-none-any.whl.zip` & `tmp/magic_toolkit-1.1.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,26 +1,26 @@
-Zip file size: 22745 bytes, number of entries: 24
--rw-rw-r--  2.0 unx      182 b- defN 24-Jan-13 02:40 magic/__init__.py
--rw-rw-r--  2.0 unx     1182 b- defN 24-Jan-13 02:03 magic/cli.py
--rw-rw-r--  2.0 unx       26 b- defN 23-Sep-02 12:39 magic/deployment/__init__.py
--rw-rw-r--  2.0 unx     6243 b- defN 24-Jan-12 12:44 magic/deployment/deploy.py
--rw-rw-r--  2.0 unx     4351 b- defN 24-Jan-12 12:44 magic/deployment/remote_manager.py
--rw-rw-r--  2.0 unx     7825 b- defN 24-Jan-12 12:44 magic/deployment/rsync.py
--rw-rw-r--  2.0 unx     6514 b- defN 24-Jan-12 12:44 magic/deployment/sftp_get.py
--rw-rw-r--  2.0 unx     6306 b- defN 24-Jan-12 12:44 magic/deployment/sftp_put.py
--rw-rw-r--  2.0 unx     3114 b- defN 24-Jan-13 02:37 magic/deployment/ssh_login.py
--rw-rw-r--  2.0 unx        0 b- defN 23-Aug-16 14:48 magic/proto/__init__.py
--rw-rw-r--  2.0 unx     6253 b- defN 24-Jan-12 12:44 magic/proto/remote_config_pb2.py
--rw-rw-r--  2.0 unx        0 b- defN 23-Sep-02 12:39 magic/scripts/__init__.py
--rw-rw-r--  2.0 unx     1009 b- defN 23-Dec-16 04:28 magic/scripts/check_cc_code_style.py
--rw-rw-r--  2.0 unx      156 b- defN 23-Aug-16 14:48 magic/scripts/force_kill.sh
--rw-rw-r--  2.0 unx     1216 b- defN 24-Jan-12 12:44 magic/scripts/shell_wrapper.py
--rw-rw-r--  2.0 unx        0 b- defN 23-Aug-16 14:48 magic/video_utils/__init__.py
--rw-rw-r--  2.0 unx     1569 b- defN 23-Aug-16 14:48 magic/video_utils/image2video.py
--rw-rw-r--  2.0 unx     2795 b- defN 23-Aug-16 14:48 magic/video_utils/record_video.py
--rw-rw-r--  2.0 unx    11558 b- defN 24-Jan-13 02:54 magic_toolkit-1.0.3.dist-info/LICENSE
--rw-rw-r--  2.0 unx      282 b- defN 24-Jan-13 02:54 magic_toolkit-1.0.3.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 24-Jan-13 02:54 magic_toolkit-1.0.3.dist-info/WHEEL
--rw-rw-r--  2.0 unx       42 b- defN 24-Jan-13 02:54 magic_toolkit-1.0.3.dist-info/entry_points.txt
--rw-rw-r--  2.0 unx        6 b- defN 24-Jan-13 02:54 magic_toolkit-1.0.3.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     2023 b- defN 24-Jan-13 02:54 magic_toolkit-1.0.3.dist-info/RECORD
-24 files, 62744 bytes uncompressed, 19441 bytes compressed:  69.0%
+Zip file size: 22931 bytes, number of entries: 24
+-rw-rw-r--  2.0 unx      182 b- defN 24-Apr-25 05:40 magic/__init__.py
+-rw-rw-r--  2.0 unx     1182 b- defN 24-Apr-25 05:35 magic/cli.py
+-rw-rw-r--  2.0 unx       26 b- defN 24-Apr-25 05:35 magic/deployment/__init__.py
+-rw-rw-r--  2.0 unx     6243 b- defN 24-Apr-25 05:35 magic/deployment/deploy.py
+-rw-rw-r--  2.0 unx     4474 b- defN 24-Apr-25 05:35 magic/deployment/remote_manager.py
+-rw-rw-r--  2.0 unx     7885 b- defN 24-Apr-25 05:35 magic/deployment/rsync.py
+-rw-rw-r--  2.0 unx     6569 b- defN 24-Apr-25 05:35 magic/deployment/sftp_get.py
+-rw-rw-r--  2.0 unx     6306 b- defN 24-Apr-25 05:35 magic/deployment/sftp_put.py
+-rw-rw-r--  2.0 unx     3698 b- defN 24-Apr-25 05:35 magic/deployment/ssh_login.py
+-rw-rw-r--  2.0 unx        0 b- defN 24-Apr-25 05:35 magic/proto/__init__.py
+-rw-rw-r--  2.0 unx     6253 b- defN 24-Apr-25 05:35 magic/proto/remote_config_pb2.py
+-rw-rw-r--  2.0 unx        0 b- defN 24-Apr-25 05:35 magic/scripts/__init__.py
+-rw-rw-r--  2.0 unx     1009 b- defN 24-Apr-25 05:35 magic/scripts/check_cc_code_style.py
+-rw-rw-r--  2.0 unx      156 b- defN 24-Apr-25 05:35 magic/scripts/force_kill.sh
+-rw-rw-r--  2.0 unx     1216 b- defN 24-Apr-25 05:35 magic/scripts/shell_wrapper.py
+-rw-rw-r--  2.0 unx        0 b- defN 24-Apr-25 05:35 magic/video_utils/__init__.py
+-rw-rw-r--  2.0 unx     1569 b- defN 24-Apr-25 05:35 magic/video_utils/image2video.py
+-rw-rw-r--  2.0 unx     2795 b- defN 24-Apr-25 05:35 magic/video_utils/record_video.py
+-rw-rw-r--  2.0 unx    11558 b- defN 24-Apr-25 05:42 magic_toolkit-1.1.0.dist-info/LICENSE
+-rw-rw-r--  2.0 unx      235 b- defN 24-Apr-25 05:42 magic_toolkit-1.1.0.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 24-Apr-25 05:42 magic_toolkit-1.1.0.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       41 b- defN 24-Apr-25 05:42 magic_toolkit-1.1.0.dist-info/entry_points.txt
+-rw-rw-r--  2.0 unx        6 b- defN 24-Apr-25 05:42 magic_toolkit-1.1.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2023 b- defN 24-Apr-25 05:42 magic_toolkit-1.1.0.dist-info/RECORD
+24 files, 63518 bytes uncompressed, 19627 bytes compressed:  69.1%
```

## zipnote {}

```diff
@@ -48,26 +48,26 @@
 
 Filename: magic/video_utils/image2video.py
 Comment: 
 
 Filename: magic/video_utils/record_video.py
 Comment: 
 
-Filename: magic_toolkit-1.0.3.dist-info/LICENSE
+Filename: magic_toolkit-1.1.0.dist-info/LICENSE
 Comment: 
 
-Filename: magic_toolkit-1.0.3.dist-info/METADATA
+Filename: magic_toolkit-1.1.0.dist-info/METADATA
 Comment: 
 
-Filename: magic_toolkit-1.0.3.dist-info/WHEEL
+Filename: magic_toolkit-1.1.0.dist-info/WHEEL
 Comment: 
 
-Filename: magic_toolkit-1.0.3.dist-info/entry_points.txt
+Filename: magic_toolkit-1.1.0.dist-info/entry_points.txt
 Comment: 
 
-Filename: magic_toolkit-1.0.3.dist-info/top_level.txt
+Filename: magic_toolkit-1.1.0.dist-info/top_level.txt
 Comment: 
 
-Filename: magic_toolkit-1.0.3.dist-info/RECORD
+Filename: magic_toolkit-1.1.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## magic/__init__.py

```diff
@@ -1,8 +1,8 @@
 import platform
 import os
 
-__version__ = "1.0.3"
+__version__ = "1.1.0"
 
 config_root = ''
 if 'linux' in platform.system().lower():
     config_root = os.path.join(os.path.expanduser('~'), '.magic-toolkit')
```

## magic/deployment/remote_manager.py

```diff
@@ -19,18 +19,22 @@
         return self.username + '@' + self.ip
 
     def __repr__(self):
         string = str(self.host) + '\n'
         string += '  name: {}\n'.format(self.name)
         string += '  ip: {}\n'.format(self.ip)
         string += '  username: {}\n'.format(self.username)
-        string += '  password: {}\n'.format(self.password)
-        string += '  port: {}\n'.format(self.port)
-        string += '  IdentityFile: {}\n'.format(self.IdentityFile)
-        string += '  description: {}\n'.format(self.description)
+        if self.password:
+            string += '  password: {}\n'.format(self.password)
+        if self.port:
+            string += '  port: {}\n'.format(self.port)
+        if self.IdentityFile:
+            string += '  IdentityFile: {}\n'.format(self.IdentityFile)
+        if self.description:
+            string += '  description: {}\n'.format(self.description)
         return string
 
 class RemoteDeviceManager:
     def __init__(self, default_port=22):
         self.remote_devices: List[Device] = []
         self.default_port = default_port
         self.remote_config_file = os.path.join(magic.config_root, 'remote_device.pt')
```

## magic/deployment/rsync.py

```diff
@@ -63,15 +63,15 @@
         for path in paths:
             assert not path.startswith('/'), 'need relative path'
             path = path.rstrip('/')
             remote_path = os.path.abspath(os.path.join(self.remote_root, path))
             local_path = os.path.abspath(os.path.join(self.local_root, path))
             path_type = self.sftp.check_path_type(remote_path)
             if path_type == 'folder':
-                os.makedirs(local_path)
+                os.makedirs(local_path, exist_ok=True)
                 self.pull_every_path(remote_path + '/', local_path + '/')
             elif path_type == "file":
                 dirname = os.path.dirname(local_path)
                 os.makedirs(dirname, exist_ok=True)
                 self.pull_every_path(remote_path, local_path)
 
     def pull_every_path(self, remote_path, local_path):
@@ -123,48 +123,50 @@
     p = sub_parsers.add_parser("rsync", help="rsync helper")
     p.add_argument('rsync_cmd', choices=["pull", "push"])
     p.add_argument('relative_paths', nargs='*', help='path1 path2 ...')
     p.add_argument('--host', default=None, help="username@ip")
     p.add_argument('--port', default=22, help="port")
     p.add_argument('--local', default=None, help="local root")
     p.add_argument('--remote', default=None, help="remote root")
-    p.add_argument('--exclude', nargs=None, help='pattern for excluding, split by semicolon')
+    p.add_argument('--exclude', action='append', help='exclude pattern')
     p.add_argument('--config', default='', help='config file, rsync.yaml')
     p.add_argument('--delete', default=False, action='store_true', help='delete extraneous files from destination dirs')
     p.add_argument('--progress', default=False, action='store_true', help='show progress during transfer')
     p.set_defaults(func=execute)
 
 def execute(args):
     conf = dict()
     if args.local and args.remote and args.host:
         # load config from argparse
         conf['local_root'] = args.local
         conf['remote_root'] = args.remote
         conf['host'] = args.host
         conf['port'] = args.port
-        if args.exclude:
-            conf['exclude'] = args.exclude.split(';')
+        conf['exclude'] = args.exclude
     else:
         # check and load yaml config file
         if args.config:
             config_file = args.config
             if not os.path.exists(config_file):
                 raise FileNotFoundError("Not found config '{}'".format(config_file))
             with open(config_file, 'r') as f:
                 conf = yaml.safe_load(f)
         else:
+            # check and load config file from local project
             workspaceFolder = os.getcwd()
             config_file = os.path.join(workspaceFolder, '.vscode/rsync.yaml')
             if not os.path.exists(config_file):
                 raise FileNotFoundError("Not found config '{}'".format(config_file))
             with open(config_file, 'r') as f:
                 yaml_conf = yaml.safe_load(f)
-                if yaml_conf.get('local_root') is not None and yaml_conf['local_root'] != workspaceFolder:
+                if yaml_conf.get('local_root') is None:
+                    raise KeyError("missed key 'local_root'")
+                if yaml_conf['local_root'] != workspaceFolder:
                     raise KeyError("key 'local_root' in json_conf unmatched with workspaceFolder")
-                conf.update(yaml_conf, local_root=workspaceFolder)
+                conf.update(yaml_conf)
 
     rsync_helper = RsyncHelper(host=conf['host'],
                                port=conf['port'],
                                local_root=conf['local_root'],
                                remote_root=conf['remote_root'],
                                excludes=conf.get('exclude', None),
                                delete=args.delete,
```

## magic/deployment/sftp_get.py

```diff
@@ -124,29 +124,30 @@
             pass  # new file to sync
         print(f"download: {remote_file} -> {local_file}")
         self.sftp.get(remote_file, local_file)
 
 def config_parser(sub_parsers):
     p = sub_parsers.add_parser("get", help="download files from remote with sftp")
     p.add_argument('remote', type=str, help='remote_name, usrname@ip_address')
-    p.add_argument('paths', nargs='+', help='path1 path2 ..., the last is local_path')
+    p.add_argument('paths', nargs='+', help='path1 path2 ..., the last is local_path when length>=2')
     p.add_argument('--password', type=str, help='specify or input')
     p.add_argument('-p', '--port', type=int, help='remote port', default=22)
     p.add_argument('--exclude', nargs='+', help='paths, files or extensions to filter')
     p.set_defaults(func=execute)
 
 def execute(args):
     # print(args)
     """api for download files by sftp transformer"""
-    assert len(args.paths) >= 2
+    assert len(args.paths) >= 2, 'the last path is local_root'
     remote_manager = RemoteDeviceManager()
     device = remote_manager.get_device(args.remote)
     host, password, port, IdentityFile = args.remote, args.password, args.port, None
     if device is not None:
         host, password, port, IdentityFile = device.host, device.password, device.port, device.IdentityFile
+        
     client = SftpClient(
         local_root=args.paths[-1],
         remote_paths=args.paths[:-1],
         host=host,
         password=password,
         port=port,
         exclude=args.exclude,
```

## magic/deployment/ssh_login.py

```diff
@@ -3,75 +3,98 @@
 from .remote_manager import RemoteDeviceManager
 import magic
 import yaml
 import argparse
 
 _custom_help = '''
 usage: 
-  magic ssh host                 # connect remote host (username@ip)
-  magic ssh -p root@127.0.0.1    # specify port
-  magic ssh config               # register device
+  magic ssh host                           # connect remote host (username@ip)
+  magic ssh -p 2222 root@10.203.254.178    # specify port
+  magic ssh config                         # register device
   ...
                  
 positional arguments:
   list                  list all registered devices 
   info                  find and display details about host/name
   config                register device
   
 optional arguments:
   -h, --help            show this help message and exit
   --password            password
   -p, --port            port
   --config              load conf from file, eg. rsync.yaml
+  -L                    map local port
 '''
 
+
 class CustomHelpFormatter(argparse.HelpFormatter):
     def format_help(self):
         custom_help = _custom_help
         return custom_help
 
+
 def config_parser(sub_parsers):
     p = sub_parsers.add_parser("ssh", help="ssh helper, check remote devices",
                                formatter_class=CustomHelpFormatter)
     p.add_argument('argv', nargs="*", help='command args')
     p.add_argument('--password', default=None, help='password')
     p.add_argument('-p', '--port', type=int, default=22, help='port')
     p.add_argument('--config', help='rsync.yaml')
+    p.add_argument('-L', '--map-local', default=None, help='map local port')
     p.set_defaults(func=execute)
 
+
 def execute(args):
     argv = args.argv
+    default_args = dict(
+        password=args.password,
+        port=args.port,
+        map_local=args.map_local
+    )
+
     remote_manager = RemoteDeviceManager()
     # 参数解析
     if len(argv) == 0:
+        # 解析配置文件的参数，不使用命令行参数
         config_file = args.config or os.path.join(os.getcwd(), '.vscode/rsync.yaml')
         if not os.path.exists(config_file):
             raise FileNotFoundError("Not found config '{}'".format(config_file))
         with open(config_file, 'r') as f:
             conf = yaml.safe_load(f)
-        ssh_connect(conf['host'], conf.get('password'), conf.get('port', 22),
-                    IdentityFile=conf.get("IdentityFile"))
+        default_args['host'] = conf['host']
+        default_args['password'] = conf.get('password')
+        default_args['port'] = conf.get('port', 22)
+        default_args['IdentityFile'] = conf.get('IdentityFile', None)
+        ssh_connect(**default_args)
     elif argv[0] == 'list':
         remote_manager.list_all_devices()
     elif argv[0] == 'info':
         device = remote_manager.get_device(argv[1])
         print(device)
     elif argv[0] == 'config':
         remote_config_file = os.path.join(magic.config_root, 'remote_device.pt')
         subprocess.run(f'gedit {remote_config_file}', shell=True)
     else:
-        host, password, port, IdentityFile = argv[0], args.password, args.port, None
+        default_args['host'] = argv[0]
         device = remote_manager.get_device(argv[0])
         if device is not None:
-            # search device by name, host
-            host, password, port, IdentityFile = device.host, device.password, device.port, device.IdentityFile
-        ssh_connect(host, password, port, IdentityFile=IdentityFile)
-
-def ssh_connect(host, password=None, port=22, **kwargs):
-    if kwargs.get('IdentityFile'):
-        subprocess.run('ssh -p {} {} -i {}'.format(port, host, kwargs.get('IdentityFile')), shell=True)
-    elif password:
+            default_args['host'] = device.host
+            default_args['password'] = device.password
+            default_args['port'] = device.port
+            default_args['IdentityFile'] = device.IdentityFile
+        ssh_connect(**default_args)
+
+def ssh_connect(host, password=None, port=22, IdentityFile=None, map_local=None):
+    if password:
         assert isinstance(password, str)
         sshpass_cmd = 'sshpass -p {} ssh -p {} -o StrictHostKeyChecking=no {}'.format(password, port, host)
+        if map_local:
+            sshpass_cmd += ' -L {}'.format(map_local)
         subprocess.run(sshpass_cmd, shell=True)
     else:
-        subprocess.run('ssh -p {} {}'.format(port, host), shell=True)
+        ssh_cmd = f'ssh -p {port} {host}'
+        if IdentityFile:
+            ssh_cmd += ' -i {}'.format(IdentityFile)
+        if map_local:
+            ssh_cmd += ' -L {}'.format(map_local)
+        print(ssh_cmd)
+        subprocess.run(ssh_cmd, shell=True)
```

## Comparing `magic_toolkit-1.0.3.dist-info/LICENSE` & `magic_toolkit-1.1.0.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `magic_toolkit-1.0.3.dist-info/RECORD` & `magic_toolkit-1.1.0.dist-info/RECORD`

 * *Files 13% similar despite different names*

```diff
@@ -1,24 +1,24 @@
-magic/__init__.py,sha256=p2r98V9NuaBPzsRnRkExd5K8cR_Bty3ldWBlr5BVkpw,182
+magic/__init__.py,sha256=bFnQA3atNY8lz0UoiEJM9MEWvYjqp3c2SYT5LLTlNwQ,182
 magic/cli.py,sha256=0i3IkqEtAthexYpkhvLmaUzaYM7IWs_AhnBUTC5A3XM,1182
 magic/deployment/__init__.py,sha256=C7JZV6pyqH0SxNralLrYUsIQ4juYzK07ENZq9ZqBfrk,26
 magic/deployment/deploy.py,sha256=EKoJQMPAlx1KNwO8QctQUsODPfhbYdOuMkEcDrG6bKY,6243
-magic/deployment/remote_manager.py,sha256=awF9msMlyIMejwCNpcDAP68XEMi-B8cd9zmq7sdOv-Q,4351
-magic/deployment/rsync.py,sha256=1XvvoqbKMzrbDMyvPBx8grLAJCFpacYYOfBxdYbQE-E,7825
-magic/deployment/sftp_get.py,sha256=iWqfuWryI0fJblAKJJGaprUB13HohYWFRdAzUicN2z4,6514
+magic/deployment/remote_manager.py,sha256=r256kmFh3LXl7O5KEbgnEIeTnuWYwbSzwsiMl3cdVKA,4474
+magic/deployment/rsync.py,sha256=9MX_ifcauGGWxTVFFpRqcS5r-ow8t0DA7rA894Gkptw,7885
+magic/deployment/sftp_get.py,sha256=KeLHso9y99RViE6lrY20L_zfsg_WJVQNQo0VlBXzeX4,6569
 magic/deployment/sftp_put.py,sha256=IhuMaz8WFB3zrjZbK4HP7Z6aUYGXOe_DbzIQ9LlfxuQ,6306
-magic/deployment/ssh_login.py,sha256=Y21095B1HfK_9eF4uK9LPeE4AJhVhiep9ZwCLQBQTew,3114
+magic/deployment/ssh_login.py,sha256=0f-hCBQiRrMD8kK2DF1DST0lqezIkR6WPURRm28YZo8,3698
 magic/proto/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 magic/proto/remote_config_pb2.py,sha256=M28QQ3ii_pF_3n_UUh9Qn-gbXyjSEo6R36zrjDgw2KQ,6253
 magic/scripts/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 magic/scripts/check_cc_code_style.py,sha256=2xqOKzSFh-uQPCMI60dq9_EBNadca2bV6j2NncWKRvg,1009
 magic/scripts/force_kill.sh,sha256=yHq-rzMRxjG2TLylnF1VxUCEMa6wuuZETGr5L-vKM1M,156
 magic/scripts/shell_wrapper.py,sha256=VTOL3oNXsM0OYBV6Xv1U63c-Un4EWZRwIykLgt63mS8,1216
 magic/video_utils/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 magic/video_utils/image2video.py,sha256=QYgZRTZ3QAApq8HWQf9YFQBAjsyQF0Y3h3sSWy3XKK4,1569
 magic/video_utils/record_video.py,sha256=virDqxyrN7A4Nv5oF7ftT463RGq_Y57opMtc5z6NCVI,2795
-magic_toolkit-1.0.3.dist-info/LICENSE,sha256=HrhfyXIkWY2tGFK11kg7vPCqhgh5DcxleloqdhrpyMY,11558
-magic_toolkit-1.0.3.dist-info/METADATA,sha256=gXR87L7__AcJ1IYosC2y0HK_eBDh02efuvtGS1C6yUU,282
-magic_toolkit-1.0.3.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-magic_toolkit-1.0.3.dist-info/entry_points.txt,sha256=lI7UwdQZup8sPikrYwYiMrukqZjtS-z2K2jrSeD70eY,42
-magic_toolkit-1.0.3.dist-info/top_level.txt,sha256=MDDOZCPmPBiPXW10LHC6RzAJaGX08WaDj_oOOo7sQRc,6
-magic_toolkit-1.0.3.dist-info/RECORD,,
+magic_toolkit-1.1.0.dist-info/LICENSE,sha256=HrhfyXIkWY2tGFK11kg7vPCqhgh5DcxleloqdhrpyMY,11558
+magic_toolkit-1.1.0.dist-info/METADATA,sha256=z-kvW5pZ-osfTBPePxnEkhnRACDbG7bo5D1871UOrf4,235
+magic_toolkit-1.1.0.dist-info/WHEEL,sha256=yQN5g4mg4AybRjkgi-9yy4iQEFibGQmlz78Pik5Or-A,92
+magic_toolkit-1.1.0.dist-info/entry_points.txt,sha256=vij2DYBNTjXN6mrb3zejBn_ZcP4RAMoftg-18lQDzhY,41
+magic_toolkit-1.1.0.dist-info/top_level.txt,sha256=MDDOZCPmPBiPXW10LHC6RzAJaGX08WaDj_oOOo7sQRc,6
+magic_toolkit-1.1.0.dist-info/RECORD,,
```

