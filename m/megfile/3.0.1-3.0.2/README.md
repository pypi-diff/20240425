# Comparing `tmp/megfile-3.0.1-py3-none-any.whl.zip` & `tmp/megfile-3.0.2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,32 +1,32 @@
-Zip file size: 126797 bytes, number of entries: 52
+Zip file size: 126995 bytes, number of entries: 52
 -rw-rw-r--  2.0 unx     6534 b- defN 23-Oct-16 09:18 megfile/__init__.py
--rw-rw-r--  2.0 unx    21343 b- defN 24-Mar-08 09:31 megfile/cli.py
+-rw-rw-r--  2.0 unx    21880 b- defN 24-Apr-24 09:19 megfile/cli.py
 -rw-rw-r--  2.0 unx      658 b- defN 23-Dec-12 08:15 megfile/config.py
--rw-rw-r--  2.0 unx    13323 b- defN 23-Dec-12 08:15 megfile/errors.py
+-rw-rw-r--  2.0 unx    13323 b- defN 24-Apr-24 07:04 megfile/errors.py
 -rw-rw-r--  2.0 unx    11547 b- defN 24-Jan-22 05:53 megfile/fs.py
 -rw-rw-r--  2.0 unx    38237 b- defN 24-Jan-22 05:18 megfile/fs_path.py
 -rw-rw-r--  2.0 unx     9156 b- defN 24-Jan-22 05:53 megfile/hdfs.py
 -rw-rw-r--  2.0 unx    26677 b- defN 23-Dec-12 08:15 megfile/hdfs_path.py
 -rw-rw-r--  2.0 unx     2032 b- defN 24-Jan-22 05:53 megfile/http.py
 -rw-rw-r--  2.0 unx    11396 b- defN 23-Dec-12 08:15 megfile/http_path.py
 -rw-rw-r--  2.0 unx     6219 b- defN 23-Jul-07 04:07 megfile/interfaces.py
 -rw-rw-r--  2.0 unx    29487 b- defN 23-Oct-16 09:18 megfile/pathlike.py
 -rw-rw-r--  2.0 unx    12352 b- defN 24-Jan-22 05:53 megfile/s3.py
 -rw-rw-r--  2.0 unx    90791 b- defN 23-Dec-12 08:15 megfile/s3_path.py
 -rw-rw-r--  2.0 unx    12524 b- defN 24-Jan-22 05:53 megfile/sftp.py
--rw-rw-r--  2.0 unx    51572 b- defN 24-Mar-08 08:45 megfile/sftp_path.py
--rw-rw-r--  2.0 unx    33416 b- defN 24-Jan-04 02:23 megfile/smart.py
+-rw-rw-r--  2.0 unx    51666 b- defN 24-Apr-24 08:36 megfile/sftp_path.py
+-rw-rw-r--  2.0 unx    33725 b- defN 24-Apr-24 08:36 megfile/smart.py
 -rw-rw-r--  2.0 unx     6749 b- defN 23-Sep-19 01:59 megfile/smart_path.py
 -rw-rw-r--  2.0 unx      707 b- defN 24-Jan-22 05:53 megfile/stdio.py
 -rw-rw-r--  2.0 unx     2873 b- defN 23-Aug-18 08:55 megfile/stdio_path.py
--rw-rw-r--  2.0 unx       19 b- defN 24-Mar-08 09:46 megfile/version.py
+-rw-rw-r--  2.0 unx       19 b- defN 24-Apr-24 09:33 megfile/version.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-May-25 06:42 megfile/lib/__init__.py
 -rw-rw-r--  2.0 unx    13191 b- defN 23-Dec-12 08:15 megfile/lib/base_prefetch_reader.py
--rw-rw-r--  2.0 unx     4546 b- defN 24-Mar-08 08:47 megfile/lib/combine_reader.py
+-rw-rw-r--  2.0 unx     4546 b- defN 24-Apr-24 09:09 megfile/lib/combine_reader.py
 -rw-rw-r--  2.0 unx     2233 b- defN 23-Nov-09 02:49 megfile/lib/compare.py
 -rw-rw-r--  2.0 unx      234 b- defN 24-Jan-22 05:18 megfile/lib/compat.py
 -rw-rw-r--  2.0 unx     4054 b- defN 23-Nov-17 02:51 megfile/lib/fnmatch.py
 -rw-rw-r--  2.0 unx     9732 b- defN 23-Jul-07 05:32 megfile/lib/glob.py
 -rw-rw-r--  2.0 unx     2040 b- defN 23-Dec-12 08:15 megfile/lib/hdfs_prefetch_reader.py
 -rw-rw-r--  2.0 unx      442 b- defN 23-Oct-16 09:18 megfile/lib/hdfs_tools.py
 -rw-rw-r--  2.0 unx     3352 b- defN 23-Dec-12 08:15 megfile/lib/http_prefetch_reader.py
@@ -34,21 +34,21 @@
 -rw-rw-r--  2.0 unx     1915 b- defN 23-May-25 06:42 megfile/lib/lazy_handler.py
 -rw-rw-r--  2.0 unx     7017 b- defN 23-Dec-12 08:15 megfile/lib/s3_buffered_writer.py
 -rw-rw-r--  2.0 unx     1412 b- defN 23-Sep-20 08:59 megfile/lib/s3_cached_handler.py
 -rw-rw-r--  2.0 unx     6150 b- defN 23-Dec-12 08:15 megfile/lib/s3_limited_seekable_writer.py
 -rw-rw-r--  2.0 unx     3971 b- defN 23-Sep-20 08:59 megfile/lib/s3_memory_handler.py
 -rw-rw-r--  2.0 unx     3557 b- defN 23-Sep-20 08:59 megfile/lib/s3_pipe_handler.py
 -rw-rw-r--  2.0 unx     4249 b- defN 23-Dec-12 08:15 megfile/lib/s3_prefetch_reader.py
--rw-rw-r--  2.0 unx     3564 b- defN 24-Mar-08 08:47 megfile/lib/s3_share_cache_reader.py
+-rw-rw-r--  2.0 unx     3564 b- defN 24-Apr-24 09:09 megfile/lib/s3_share_cache_reader.py
 -rw-rw-r--  2.0 unx     2683 b- defN 23-May-25 06:42 megfile/lib/shadow_handler.py
 -rw-rw-r--  2.0 unx     2044 b- defN 23-May-25 06:42 megfile/lib/stdio_handler.py
 -rw-rw-r--  2.0 unx      103 b- defN 23-Jun-16 02:18 megfile/lib/url.py
 -rw-rw-r--  2.0 unx     9162 b- defN 23-Aug-18 08:26 megfile/utils/__init__.py
 -rw-rw-r--  2.0 unx     2538 b- defN 23-Jul-13 03:47 megfile/utils/mutex.py
--rw-rw-r--  2.0 unx    11357 b- defN 24-Mar-08 09:46 megfile-3.0.1.dist-info/LICENSE
--rw-rw-r--  2.0 unx     1080 b- defN 24-Mar-08 09:46 megfile-3.0.1.dist-info/LICENSE.pyre
--rw-rw-r--  2.0 unx     8916 b- defN 24-Mar-08 09:46 megfile-3.0.1.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 24-Mar-08 09:46 megfile-3.0.1.dist-info/WHEEL
--rw-rw-r--  2.0 unx       49 b- defN 24-Mar-08 09:46 megfile-3.0.1.dist-info/entry_points.txt
--rw-rw-r--  2.0 unx        8 b- defN 24-Mar-08 09:46 megfile-3.0.1.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     4182 b- defN 24-Mar-08 09:46 megfile-3.0.1.dist-info/RECORD
-52 files, 502414 bytes uncompressed, 120271 bytes compressed:  76.1%
+-rw-rw-r--  2.0 unx    11357 b- defN 24-Apr-24 09:33 megfile-3.0.2.dist-info/LICENSE
+-rw-rw-r--  2.0 unx     1080 b- defN 24-Apr-24 09:33 megfile-3.0.2.dist-info/LICENSE.pyre
+-rw-rw-r--  2.0 unx     8916 b- defN 24-Apr-24 09:33 megfile-3.0.2.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 24-Apr-24 09:33 megfile-3.0.2.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       49 b- defN 24-Apr-24 09:33 megfile-3.0.2.dist-info/entry_points.txt
+-rw-rw-r--  2.0 unx        8 b- defN 24-Apr-24 09:33 megfile-3.0.2.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     4182 b- defN 24-Apr-24 09:33 megfile-3.0.2.dist-info/RECORD
+52 files, 503354 bytes uncompressed, 120469 bytes compressed:  76.1%
```

## zipnote {}

```diff
@@ -129,29 +129,29 @@
 
 Filename: megfile/utils/__init__.py
 Comment: 
 
 Filename: megfile/utils/mutex.py
 Comment: 
 
-Filename: megfile-3.0.1.dist-info/LICENSE
+Filename: megfile-3.0.2.dist-info/LICENSE
 Comment: 
 
-Filename: megfile-3.0.1.dist-info/LICENSE.pyre
+Filename: megfile-3.0.2.dist-info/LICENSE.pyre
 Comment: 
 
-Filename: megfile-3.0.1.dist-info/METADATA
+Filename: megfile-3.0.2.dist-info/METADATA
 Comment: 
 
-Filename: megfile-3.0.1.dist-info/WHEEL
+Filename: megfile-3.0.2.dist-info/WHEEL
 Comment: 
 
-Filename: megfile-3.0.1.dist-info/entry_points.txt
+Filename: megfile-3.0.2.dist-info/entry_points.txt
 Comment: 
 
-Filename: megfile-3.0.1.dist-info/top_level.txt
+Filename: megfile-3.0.2.dist-info/top_level.txt
 Comment: 
 
-Filename: megfile-3.0.1.dist-info/RECORD
+Filename: megfile-3.0.2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## megfile/cli.py

```diff
@@ -439,15 +439,20 @@
 @click.argument('path')
 @click.option(
     '-n',
     '--lines',
     type=click.INT,
     default=10,
     help='print the last NUM lines')
-def tail(path: str, lines: int):
+@click.option(
+    '-f',
+    '--follow',
+    is_flag=True,
+    help='output appended data as the file grows')
+def tail(path: str, lines: int, follow: bool):
     line_list = []
     with smart_open(path, 'rb') as f:
         f.seek(0, os.SEEK_END)
         file_size = f.tell()
         f.seek(0, os.SEEK_SET)
 
         for current_offset in range(file_size - DEFAULT_BLOCK_SIZE,
@@ -460,16 +465,31 @@
                 block_lines[-1] += line_list[0]
                 block_lines.extend(line_list[1:])
             if len(block_lines) > lines:
                 line_list = block_lines[-lines:]
                 break
             else:
                 line_list = block_lines
-    for line in line_list:
+
+    for line in line_list[:-1]:
         click.echo(line)
+    if line_list:
+        click.echo(line_list[-1], nl=False)
+
+    if follow:
+        offset = file_size
+        while True:
+            with smart_open(path, 'rb') as f:
+                f.seek(offset)
+                line = f.readline()
+                offset = f.tell()
+                if not line:
+                    time.sleep(1)
+                    continue
+                click.echo(line, nl=False)
 
 
 @cli.command(short_help='Write bytes from stdin to file.')
 @click.argument('path')
 @click.option('-a', '--append', is_flag=True, help='Append to the given file')
 @click.option(
     '-o', '--stdout', is_flag=True, help='File content to standard output')
```

## megfile/sftp_path.py

```diff
@@ -1118,14 +1118,16 @@
         '''
         Return a SftpPath instance representing the path to which the symbolic link points.
         :returns: Return a SftpPath instance representing the path to which the symbolic link points.
         '''
         if not self.is_symlink():
             raise OSError('Not a symlink: %s' % self.path_with_protocol)
         path = self._client.readlink(self._real_path)
+        if not path:
+            raise OSError('Not a symlink: %s' % self.path_with_protocol)
         if not path.startswith('/'):
             return self.parent.joinpath(path)
         return self._generate_path_object(path)
 
     def is_symlink(self) -> bool:
         '''Test whether a path is a symbolic link
```

## megfile/smart.py

```diff
@@ -3,15 +3,15 @@
 from functools import partial
 from stat import S_ISDIR as stat_isdir
 from stat import S_ISLNK as stat_islnk
 from typing import IO, Any, AnyStr, BinaryIO, Callable, Iterable, Iterator, List, Optional, Tuple
 
 from tqdm import tqdm
 
-from megfile.errors import SameFileError
+from megfile.errors import S3UnknownError
 from megfile.fs import fs_copy, is_fs
 from megfile.interfaces import Access, ContextIterator, FileCacher, FileEntry, NullCacher, PathLike, StatResult
 from megfile.lib.combine_reader import CombineReader
 from megfile.lib.compare import get_sync_type, is_same_file
 from megfile.lib.compat import fspath
 from megfile.lib.glob import globlize, ungloblize
 from megfile.s3 import is_s3, s3_concat, s3_copy, s3_download, s3_load_content, s3_open, s3_upload
@@ -327,17 +327,25 @@
     src_protocol, _ = SmartPath._extract_protocol(src_path)
     dst_protocol, _ = SmartPath._extract_protocol(dst_path)
 
     try:
         copy_func = _copy_funcs[src_protocol][dst_protocol]
     except KeyError:
         copy_func = _default_copy_func
-    copy_func(
-        src_path, dst_path, callback=callback,
-        followlinks=followlinks)  # type: ignore
+    try:
+        copy_func(
+            src_path, dst_path, callback=callback,
+            followlinks=followlinks)  # type: ignore
+    except S3UnknownError as e:
+        if 'cannot schedule new futures after interpreter shutdown' in str(e):
+            _default_copy_func(
+                src_path, dst_path, callback=callback,
+                followlinks=followlinks)  # type: ignore
+        else:
+            raise
 
 
 def _smart_sync_single_file(items: dict):
     src_root_path = items['src_root_path']
     dst_root_path = items['dst_root_path']
     src_file_path = items['src_file_path']
     callback = items['callback']
```

## megfile/version.py

```diff
@@ -1 +1 @@
-VERSION = "3.0.1"
+VERSION = "3.0.2"
```

## Comparing `megfile-3.0.1.dist-info/LICENSE` & `megfile-3.0.2.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `megfile-3.0.1.dist-info/LICENSE.pyre` & `megfile-3.0.2.dist-info/LICENSE.pyre`

 * *Files identical despite different names*

## Comparing `megfile-3.0.1.dist-info/METADATA` & `megfile-3.0.2.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: megfile
-Version: 3.0.1
+Version: 3.0.2
 Summary: Megvii file operation library
 Home-page: https://github.com/megvii-research/megfile
 Author: megvii
 Author-email: megfile@megvii.com
 Classifier: Development Status :: 4 - Beta
 Classifier: Environment :: Console
 Classifier: Intended Audience :: Developers
```

## Comparing `megfile-3.0.1.dist-info/RECORD` & `megfile-3.0.2.dist-info/RECORD`

 * *Files 4% similar despite different names*

```diff
@@ -1,28 +1,28 @@
 megfile/__init__.py,sha256=MT8SIXsmEUvtSpd1GHv6e3fFfR1gRnlEdkNNqv3gngo,6534
-megfile/cli.py,sha256=F-w-wmjjQOfy20b0vb7kOC8CGfUxFbHDWj0UQ43GcgY,21343
+megfile/cli.py,sha256=yB2VnSaxrjNS67KL6CYRaMo72VNgyvuxCXuSfcGu6hM,21880
 megfile/config.py,sha256=Mz91CpRJJtepidOPXs98wYskmbbHRByG1VCeKJ81kVg,658
 megfile/errors.py,sha256=Sbx3UEKnzuyUmB1tFU9cZv61Yr4dRa79J6D0UMmkvj4,13323
 megfile/fs.py,sha256=OfY0z4GSl8fT3mDGdeqP2hWFsd1QJl-h8RkSbg6-M8I,11547
 megfile/fs_path.py,sha256=sHn-sBcvq7SvYN71onkA_ssLs71NzM1MM3d3Sug8uzo,38237
 megfile/hdfs.py,sha256=aAkHobOO0nDcLoqj0tx_1tvgoLOCooTWuukq0pO-nQA,9156
 megfile/hdfs_path.py,sha256=rVmdHydhe0x6Vn7hblewghiWZIdZswe4hfxLOHm8vCM,26677
 megfile/http.py,sha256=a3oAuARSSaIU8VMx86Mui0N5Vh-EI0AoHnwxRU5DSMU,2032
 megfile/http_path.py,sha256=ciqS32V0G3A7GVOU_lqVzRjZeyr9skXfsU87SPrkyS4,11396
 megfile/interfaces.py,sha256=h3tWE8hVt5S-HopaMAX6lunPJ97vzhv6jH_2HubcDNc,6219
 megfile/pathlike.py,sha256=Ere6tMf2nsI7bDsZo0WBzl_2HRrS_4iKOpYp0zZltAU,29487
 megfile/s3.py,sha256=siBZfveWX1TDA4Mp41UvugcG3zlrhl_iPUbixUp1TmI,12352
 megfile/s3_path.py,sha256=FYGjifwbhfraWZKKGRcuRAyllJwFcv_H1wjN5kYGzcw,90791
 megfile/sftp.py,sha256=JCkF2v1ZbHuIy_Bg3l85AesjFDimDzx9Gh1gRoMsahc,12524
-megfile/sftp_path.py,sha256=gIVTITfhKEYKyqlzn5WuAsZ_uiT1YElivWtmj-Gfh3k,51572
-megfile/smart.py,sha256=YoRvxEaZ_C-A5gQlFEs4sGBJ6D26s0qYEBJEcny_jBg,33416
+megfile/sftp_path.py,sha256=ErPKmwgaCOvvhp3aKhqX9WKIAGbWR30QUWvptQWtag8,51666
+megfile/smart.py,sha256=y5Dzr7_f0jS2FJDF4tWbEO4SPf39zqYftqkVgMhiJds,33725
 megfile/smart_path.py,sha256=Y0UFh4J2ccydRY2W-wX2ubaf9zzJx1M2nf-VLBGe4mk,6749
 megfile/stdio.py,sha256=yRhlfUA2DHi3bq-9cXsSlbLCnHvS_zvglO2IYYyPsGc,707
 megfile/stdio_path.py,sha256=eQulTXUwHvUKA-5PKCGfVNiEPkJhG9YtVhtU58OcmoM,2873
-megfile/version.py,sha256=HLZDfxYBhUytEECoyqu7fod5oNr7PzV4p7FrLz2ifpM,19
+megfile/version.py,sha256=HGcItPfK5-rkjDD8Y1bmaADbd3qo7wyXrM39-uif4RY,19
 megfile/lib/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 megfile/lib/base_prefetch_reader.py,sha256=9HT0tcgXa95BdbyclpDEDw8WwKi6091GRQerS90-pjE,13191
 megfile/lib/combine_reader.py,sha256=XFSqEY5A5X5Uf7eQ6AXAzrvNteESSXvKNVPktGjo3KY,4546
 megfile/lib/compare.py,sha256=yG2fZve_gMg32rQVCdwixBdqgYRsjn-24TqhALQaOrA,2233
 megfile/lib/compat.py,sha256=0wt3_atcYhSLCxUj_WuDlQa3E1atjZfwJQ12thiFh5Q,234
 megfile/lib/fnmatch.py,sha256=HgdlnEWBsdFUOZqnW_v1kj1jeH_9lMcCqW85pyMu4vM,4054
 megfile/lib/glob.py,sha256=7i9dIput9rI9JIPyTZX-JDmFS7IP_THlX1k-35foAfw,9732
@@ -39,14 +39,14 @@
 megfile/lib/s3_prefetch_reader.py,sha256=ol_gS0J3Yr4lMBkmok3JNuhzFfTthVzmZy5z94NFGeM,4249
 megfile/lib/s3_share_cache_reader.py,sha256=ecx-62wGqgTn5vHIpKhNACCHdYWm6oc1_xwy3vkV4m0,3564
 megfile/lib/shadow_handler.py,sha256=IbFyTw107t-yWH0cGrDjAJX-CS3xeEr77_PTGsnSgk4,2683
 megfile/lib/stdio_handler.py,sha256=QDWtcZxz-hzi-rqQUiSlR3NrihX1fjK_Rj9T2mdTFEg,2044
 megfile/lib/url.py,sha256=VbQLjo0s4AaV0iSk66BcjI68aUTcN9zBZ5x6-cM4Qvs,103
 megfile/utils/__init__.py,sha256=qdX8FF_dYFKwp1BIWx3JeSGd91s7AKUDSEpDv9tORcM,9162
 megfile/utils/mutex.py,sha256=-2KH3bNovKRd9zvsXq9n3bWM7rQdoG9hO7tUPxVG_Po,2538
-megfile-3.0.1.dist-info/LICENSE,sha256=WNHhf_5RCaeuKWyq_K39vmp9F28LxKsB4SpomwSZ2L0,11357
-megfile-3.0.1.dist-info/LICENSE.pyre,sha256=9lf5nT-5ZH25JijpYAequ0bl8E8z5JmZB1qrjiUMp84,1080
-megfile-3.0.1.dist-info/METADATA,sha256=rST56VqiyiU3doAoX66z1SmlK14KtR6Gl3osEpU_ksY,8916
-megfile-3.0.1.dist-info/WHEEL,sha256=oiQVh_5PnQM0E3gPdiz09WCNmwiHDMaGer_elqB3coM,92
-megfile-3.0.1.dist-info/entry_points.txt,sha256=M6ZWSSv5_5_QtIpZafy3vq7WuOJ_5dSGQQnEZbByt2Q,49
-megfile-3.0.1.dist-info/top_level.txt,sha256=i3rMgdU1ZAJekAceojhA-bkm3749PzshtRmLTbeLUPQ,8
-megfile-3.0.1.dist-info/RECORD,,
+megfile-3.0.2.dist-info/LICENSE,sha256=WNHhf_5RCaeuKWyq_K39vmp9F28LxKsB4SpomwSZ2L0,11357
+megfile-3.0.2.dist-info/LICENSE.pyre,sha256=9lf5nT-5ZH25JijpYAequ0bl8E8z5JmZB1qrjiUMp84,1080
+megfile-3.0.2.dist-info/METADATA,sha256=DnkmGRjSQJP0v3CgkHNwp7th5pKwJcF7qyKUN1tKaDs,8916
+megfile-3.0.2.dist-info/WHEEL,sha256=oiQVh_5PnQM0E3gPdiz09WCNmwiHDMaGer_elqB3coM,92
+megfile-3.0.2.dist-info/entry_points.txt,sha256=M6ZWSSv5_5_QtIpZafy3vq7WuOJ_5dSGQQnEZbByt2Q,49
+megfile-3.0.2.dist-info/top_level.txt,sha256=i3rMgdU1ZAJekAceojhA-bkm3749PzshtRmLTbeLUPQ,8
+megfile-3.0.2.dist-info/RECORD,,
```

